var Lore={Version:"0.0.1"};"function"==typeof define&&define.amd?define("lore",Lore):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=Lore),Lore.Mouse={Left:0,Middle:1,Right:2},Lore.Keyboard={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Esc:27},Lore.Shaders={},Lore.init=function(t){var e=(new Lore.UI(t),Lore.Color.fromHex("#222222")),n=new Lore.Renderer(t,{clearColor:e,verbose:!0,fps:document.getElementById("fps"),antialiasing:!0});new Lore.CoordinatesHelper(n,"Coordinates","default",{position:new Lore.Vector3f(0,0,0),axis:{x:{length:1e3,color:Lore.Color.fromHex("#cccccc")},y:{length:1e3,color:Lore.Color.fromHex("#cccccc")},z:{length:1e3,color:Lore.Color.fromHex("#cccccc")}},ticks:{x:{length:20,color:Lore.Color.fromHex("#cccccc")},y:{length:20,color:Lore.Color.fromHex("#cccccc")},z:{length:20,color:Lore.Color.fromHex("#cccccc")}},box:{x:{color:Lore.Color.fromHex("#666666")},y:{color:Lore.Color.fromHex("#666666")},z:{color:Lore.Color.fromHex("#666666")}}});return n.render=function(t,e){for(var o=0;o<e.length;o++)e[o].draw(n)},n},Lore.DrawModes={points:0,lines:1,lineStrip:2,lineLoop:3,triangles:4,traingleStrip:5,triangleFan:6},Lore.Color=function(t,e,n,o){1===arguments.length?this.components=new Float32Array(t):(this.components=new Float32Array(4),this.components[0]=t||0,this.components[1]=e||0,this.components[2]=n||0,this.components[3]=o||1)},Lore.Color.prototype={constructor:Lore.Color,set:function(t,e,n,o){this.components[0]=t,this.components[1]=e,this.components[2]=n,4==arguments.length&&(this.components[3]=o)}},Lore.Color.fromHex=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,n,o){return e+e+n+n+o+o});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),o=parseInt(n[1],16),r=parseInt(n[2],16),s=parseInt(n[3],16);return n?new Lore.Color(o/255,r/255,s/255,1):null},Lore.Color.hueToRgb=function(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),.1667>n?t+6*(e-t)*n:.5>n?e:.6667>n?t+(e-t)*(.6667-n)*6:t},Lore.Color.hslToRgb=function(t,e,n){var o,r,s;if(0==e)o=r=s=n;else{var i=.5>n?n*(1+e):n+e-n*e,a=2*n-i;o=Lore.Color.hueToRgb(a,i,t+.3333),r=Lore.Color.hueToRgb(a,i,t),s=Lore.Color.hueToRgb(a,i,t-.3333)}return[o,r,s]},Lore.Renderer=function(t,e){this.canvas=document.getElementById(t),this.antialiasing=e.antialiasing!==!1,this.verbose=e.verbose===!0,this.fpsElement=e.fps,this.fps=0,this.clearColor=e.clearColor||new Lore.Color,this.clearDepth="clearDepth"in e?e.clearDepth:1,this.enableDepthTest="enableDepthTest"in e?e.enableDepthTest:!0,this.camera=e.camera||new Lore.OrthographicCamera(-250,250,250,-250),this.shaders=[],this.geometries=[],this.render=function(t,e){},this.effect=null,this.lastTiming=performance.now(),this.canvas.addEventListener("contextmenu",function(t){return(t.button=2)?(t.preventDefault(),!1):void 0}),this.init(),this.controls=e.controls||new Lore.OrbitalControls(this,1200,new Lore.Vector3f(500,500,500))},Lore.Renderer.prototype={constructor:Lore.Renderer,ready:!1,gl:null,init:function(){var t=this,e={antialias:this.antialiasing};if(this.gl=this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e),!this.gl)return void console.error("Could not initialize the WebGL context.");var n=this.gl;if(this.verbose){var o=n.getContextAttributes().antialias,r=n.getParameter(n.SAMPLES);console.info("Antialiasing: "+o+" ("+r+"x)");var s=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),i=0!=s.precision;console.info("High precision support: "+i)}var a="OES_standard_derivatives",c=n.getExtension(a);null===c&&console.warn("Could not load extension: "+a+".");var h="WEBGL_draw_buffers",m=n.getExtension(h);null===m&&console.warn("Could not load extension: "+h+".");var u="WEBGL_depth_texture",p=n.getExtension(u);null===p&&console.warn("Could not load extension: "+u+".");var l=this.clearColor.components;n.clearColor(l[0],l[1],l[2],l[3]),n.clearDepth(this.clearDepth),this.enableDepthTest&&(n.enable(n.DEPTH_TEST),n.depthFunc(n.LESS),console.log("enable depth test")),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),this.updateViewport(0,0,this.canvas.width,this.canvas.height),window.addEventListener("resize",function(e){t.updateViewport(0,0,t.canvas.width,t.canvas.height)}),this.effect=new Lore.Effect(this,"defaultEffect"),this.ready=!0,this.animate()},getWidth:function(){return this.canvas.width},getHeight:function(){return this.canvas.height},updateViewport:function(t,e,n,o){this.gl.viewport(t,e,n,o)},animate:function(){var t=this;if(requestAnimationFrame(function(){t.animate()}),this.fpsElement){var e=performance.now(),n=e-this.lastTiming;this.lastTiming=e,this.fps=Math.round(1e3/n),this.fpsElement.innerHTML=this.fps}this.effect.bind(),this.render(this.camera,this.geometries),this.effect.unbind(),this.camera.isProjectionMatrixStale=!1,this.camera.isViewMatrixStale=!1},createProgram:function(t){t.init(this.gl);return this.shaders.push(t),this.shaders.length-1},createGeometry:function(t,e){var n=new Lore.Geometry(t,this.gl,this.shaders[e]);return this.geometries.push(n),n}},Lore.Shader=function(t,e,n,o){this.name=t,this.uniforms=e||{},this.vertexShader=n||[],this.fragmentShader=o||[],this.gl=null,this.program=null,this.initialized=!1,this.uniforms.modelViewMatrix=new Lore.Uniform("modelViewMatrix",(new Lore.Matrix4f).entries,"float_mat4"),this.uniforms.projectionMatrix=new Lore.Uniform("projectionMatrix",(new Lore.Matrix4f).entries,"float_mat4")},Lore.Shader.prototype={constructor:Lore.Shader,getVertexShaderCode:function(){return this.vertexShader.join("\n")},getFragmentShaderCode:function(){return this.fragmentShader.join("\n")},getVertexShader:function(t){var e=t.createShader(t.VERTEX_SHADER),n="uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n"+this.getVertexShaderCode();return t.shaderSource(e,n),t.compileShader(e),Lore.Shader.showCompilationInfo(t,e,this.name,"Vertex Shader"),e},getFragmentShader:function(t){var e=t.createShader(t.FRAGMENT_SHADER),n="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n"+this.getFragmentShaderCode();return t.shaderSource(e,n),t.compileShader(e),Lore.Shader.showCompilationInfo(t,e,this.name,"Fragment Shader"),e},init:function(t){this.gl=t,this.program=this.gl.createProgram();var e=this.getVertexShader(this.gl),n=this.getFragmentShader(this.gl);return e&&n?(this.gl.attachShader(this.program,e),this.gl.attachShader(this.program,n),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?void(this.initialized=!0):(console.error("Could not link program.\nVALIDATE_STATUS: "+this.gl.getProgramParameter(program,this.gl.VALIDATE_STATUS)+"\nERROR: "+this.gl.getError()),null)):(console.error("Failed to create the fragment or the vertex shader."),null)},updateUniforms:function(){for(var t in this.uniforms){var e=this.uniforms[t];e.stale&&Lore.Uniform.Set(this.gl,this.program,e)}},use:function(){this.gl.useProgram(this.program)}},Lore.Shader.showCompilationInfo=function(t,e,n,o){o=o||"Shader",t.getShaderParameter(e,t.COMPILE_STATUS)===!1&&console.error(o+" "+n+" did not compile."),""!==t.getShaderInfoLog(e)&&console.warn(o+" "+n+" info log: "+t.getShaderInfoLog(e))},Lore.Uniform=function(t,e,n){this.name=t,this.value=e,this.type=n,this.stale=!0},Lore.Uniform.prototype={constructor:Lore.Uniform,setValue:function(t){this.value=t,this.stale=!0}},Lore.Uniform.Set=function(t,e,n){var o=t.getUniformLocation(e,n.name);"int"===n.type?t.uniform1i(o,n.value):"int_vec2"===n.type?t.uniform2iv(o,n.value):"int_vec3"===n.type?t.uniform3iv(o,n.value):"int_vec4"===n.type?t.uniform4iv(o,n.value):"int_array"===n.type?t.uniform1iv(o,n.value):"float"===n.type?t.uniform1f(o,n.value):"float_vec2"===n.type?t.uniform2fv(o,n.value):"float_vec3"===n.type?t.uniform3fv(o,n.value):"float_vec4"===n.type?t.uniform4fv(o,n.value):"float_array"===n.type?t.uniform1fv(o,n.value):"float_mat2"===n.type?t.uniformMatrix2fv(o,!1,n.value):"float_mat3"===n.type?t.uniformMatrix3fv(o,!1,n.value):"float_mat4"===n.type&&t.uniformMatrix4fv(o,!1,n.value),n.stale=!1},Lore.Node=function(){this.type="Lore.Node",this.id=Lore.Node.createGUID(),this.isVisible=!0,this.position=new Lore.Vector3f,this.rotation=new Lore.Quaternion,this.scale=new Lore.Vector3f(1,1,1),this.up=new Lore.Vector3f(0,1,0),this.normalMatrix=new Lore.Matrix3f,this.modelMatrix=new Lore.Matrix4f,this.isStale=!1,this.children=new Array,this.parent=null},Lore.Node.prototype={constructor:Lore.Node,applyMatrix:function(t){this.modelMatrix.multiplyB(t)},getUpVector:function(){var t=new Lore.Vector3f(0,1,0);return t.applyQuaternion(this.rotation)},getForwardVector:function(){var t=new Lore.Vector3f(0,0,1);return t.applyQuaternion(this.rotation)},getRightVector:function(){var t=new Lore.Vector3f(1,0,0);return t.applyQuaternion(this.rotation)},translateOnAxis:function(t,e){var n=new Lore.Vector3f(t.components[0],t.components[1],t.components[2]);return n.applyQuaternion(this.rotation),n.multiplyScalar(e),this.position.add(n),this},translateX:function(t){return this.position.components[0]=this.position.components[0]+t,this},translateY:function(t){return this.position.components[1]=this.position.components[1]+t,this},translateZ:function(t){return this.position.components[2]=this.position.components[2]+t,this},setTranslation:function(t){return this.position=t,this},setRotation:function(t,e){return this.rotation.setFromAxisAngle(t,e),this},rotate:function(t,e){var n=new Lore.Quaternion(t,e);return this.rotation.multiplyA(n),this},rotateX:function(t){return this.rotation.rotateX(t),this},rotateY:function(t){return this.rotation.rotateY(t),this},rotateZ:function(t){return this.rotation.rotateZ(t),this},getRotationMatrix:function(){return this.rotation.toRotationMatrix()},update:function(){this.modelMatrix.compose(this.position,this.rotation,this.scale),this.isStale=!0},getModelMatrix:function(){return this.modelMatrix.entries}},Lore.Node.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},Lore.Geometry=function(t,e,n){Lore.Node.call(this),this.type="Lore.Geometry",this.name=t,this.gl=e,this.shader=n,this.attributes={},this.drawMode=this.gl.POINTS},Lore.Geometry.prototype=Object.assign(Object.create(Lore.Node.prototype),{constructor:Lore.Geometry,addAttribute:function(t,e,n){return this.attributes[t]=new Lore.Attribute(e,n,t),this.attributes[t].createBuffer(this.gl,this.shader.program),this},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},setMode:function(t){switch(t){case Lore.DrawModes.points:this.drawMode=this.gl.POINTS;break;case Lore.DrawModes.lines:this.drawMode=this.gl.LINES;break;case Lore.DrawModes.lineStrip:this.drawMode=this.gl.LINE_STRIP;break;case Lore.DrawModes.lineLoop:this.drawMode=this.gl.LINE_LOOP;break;case Lore.DrawModes.triangles:this.drawMode=this.gl.TRIANGLES;break;case Lore.DrawModes.triangleStrip:this.drawMode=this.gl.TRIANGLE_STRIP;break;case Lore.DrawModes.triangleFan:this.drawMode=this.gl.TRIANGLE_FAN}},size:function(){return Object.keys(this.attributes).length>0?this.attributes[Object.keys(this.attributes)[0]].size:0},draw:function(t){if(this.isVisible){for(var e in this.attributes)this.attributes[e].stale&&this.attributes[e].update(this.gl);if(this.shader.use(),t.camera.isProjectionMatrixStale&&this.shader.uniforms.projectionMatrix.setValue(t.camera.getProjectionMatrix()),t.camera.isViewMatrixStale){var n=Lore.Matrix4f.multiply(t.camera.viewMatrix,this.modelMatrix);this.shader.uniforms.modelViewMatrix.setValue(n.entries)}this.shader.updateUniforms();for(e in this.attributes)this.attributes[e].bind(this.gl);this.gl.drawArrays(this.drawMode,0,this.size())}}}),Lore.Attribute=function(t,e,n){this.type="Lore.Attribute",this.data=t,this.attributeLength=e||3,this.name=n,this.size=this.data.length/this.attributeLength,this.buffer=null,this.attributeLocation,this.bufferType=null,this.drawMode=null,this.stale=!1},Lore.Attribute.prototype={constructor:Lore.Attribute,setFromVector:function(t,e){this.data.set(e.components,t*this.attributeLength,e.components.length)},setFromVectorArray:function(t){if(this.attributeLength!==t[0].components.length)throw"The attribute has a length of "+this.attributeLength+". But the vectors have "+t[0].components.length+" components.";for(var e=0;e<t.length;e++)this.data.set(t[e].components,e*this.attributeLength,t[e].components.length)},getX:function(t){return this.data[t*this.attributeLength]},setX:function(t,e){this.data[t*this.attributeLength]},getY:function(t){return this.data[t*this.attributeLength+1]},setY:function(t,e){this.data[t*this.attributeLength+1]},getZ:function(t){return this.data[t*this.attributeLength+2]},setZ:function(t,e){this.data[t*this.attributeLength+2]},getW:function(t){return this.data[t*this.attributeLength+3]},setW:function(t,e){this.data[t*this.attributeLength+3]},getGlType:function(t){return t.FLOAT},update:function(t){t.bindBuffer(this.bufferType,this.buffer),t.bufferData(this.bufferType,this.data,this.drawMode),this.stale=!1},createBuffer:function(t,e,n,o){this.buffer=t.createBuffer(),this.bufferType=n||t.ARRAY_BUFFER,this.drawMode=o||t.STATIC_DRAW,t.bindBuffer(this.bufferType,this.buffer),t.bufferData(this.bufferType,this.data,this.drawMode),this.buffer.itemSize=this.attributeLength,this.buffer.numItems=this.size,this.attributeLocation=t.getAttribLocation(e,this.name),t.bindBuffer(this.bufferType,null)},bind:function(t){t.bindBuffer(this.bufferType,this.buffer),this.attributeLocation>=0&&(t.vertexAttribPointer(this.attributeLocation,this.attributeLength,this.getGlType(t),t.FALSE,0,0),t.enableVertexAttribArray(this.attributeLocation))}},Lore.Effect=function(t,e){this.renderer=t,this.gl=this.renderer.gl,this.framebuffer=this.initFramebuffer(),this.texture=this.initTexture(),this.renderbuffer=this.initRenderbuffer(),this.shader=this.renderer.shaders[this.renderer.createProgram(Lore.Shaders[e])],this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},Lore.Effect.prototype={constructor:Lore.Effect,initBuffer:function(){var t=this.gl,e=t.getAttribLocation(this.shader.program,"v_coord"),n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),n},initTexture:function(){var t=this.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.renderer.getWidth(),this.renderer.getHeight(),0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),e},initFramebuffer:function(){var t=this.gl,e=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,e),e},initRenderbuffer:function(){var t=this.gl,e=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.renderer.getWidth(),this.renderer.getHeight()),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),e},bind:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},unbind:function(){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),this.initBuffer(),this.shader.use(),t.drawArrays(t.TRIANGLES,0,6)}},Lore.ControlsBase=function(t){this.canvas=t.canvas,this.eventListeners={},this.mouse={previousPosition:{x:null,y:null},delta:{x:0,y:0},position:{x:0,y:0},state:{left:!1,middle:!1,right:!1},normalizedPosition:{x:0,y:0}},this.keyboard={alt:!1,ctrl:!1,shift:!1};var e=this;this.canvas.addEventListener("mousemove",function(t){(null!==e.mouse.previousPosition.x&&e.mouse.state.left||e.mouse.state.middle||e.mouse.state.right)&&(e.mouse.delta.x=t.pageX-e.mouse.previousPosition.x,e.mouse.delta.y=t.pageY-e.mouse.previousPosition.y,e.mouse.position.x+=.01*e.mouse.delta.x,e.mouse.position.y+=.01*e.mouse.delta.y,e.raiseEvent("mousemove",{e:e.mouse.delta}),e.mouse.state.left?e.raiseEvent("mousedrag",{e:e.mouse.delta,source:"left"}):e.mouse.state.middle?e.raiseEvent("mousedrag",{e:e.mouse.delta,source:"middle"}):e.mouse.state.right&&e.raiseEvent("mousedrag",{e:e.mouse.delta,source:"right"})),e.mouse.previousPosition.x=t.pageX,e.mouse.previousPosition.y=t.pageY});var n="mousewheel";navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(n="DOMMouseScroll"),this.canvas.addEventListener(n,function(t){e.raiseEvent("mousewheel",{e:t.wheelDelta})}),this.canvas.addEventListener("keydown",function(t){16==t.which?e.keyboard.shift=!0:17==t.which?e.keyboard.ctrl=!0:18==t.which&&(e.keyboard.alt=!0),e.raiseEvent("keydown",{e:t.which})}),this.canvas.addEventListener("keyup",function(t){16==t.which?e.keyboard.shift=!1:17==t.which?e.keyboard.ctrl=!1:18==t.which&&(e.keyboard.alt=!1),e.raiseEvent("keyup",{e:t.which})}),this.canvas.addEventListener("mousedown",function(t){var n=t.button,o="left";0==n?e.mouse.state.left=!0:1==n?(e.mouse.state.middle=!0,o="middle"):2==n&&(e.mouse.state.right=!0,o="right");var r=e.canvas.getBoundingClientRect();e.mouse.normalizedPosition.x=(t.clientX-r.left)/e.canvas.width*2-1,e.mouse.normalizedPosition.y=2*-((t.clientY-r.top)/e.canvas.height)+1,e.raiseEvent("mousedown",{e:e,source:o})}),this.canvas.addEventListener("mouseup",function(t){var n=t.button,o="left";0==n?e.mouse.state.left=!1:1==n?(e.mouse.state.middle=!1,o="middle"):2==n&&(e.mouse.state.right=!1,o="right"),e.mouse.previousPosition.x=null,e.mouse.previousPosition.y=null,e.raiseEvent("mouseup",{e:e,source:o})})},Lore.ControlsBase.prototype={constructor:Lore.ControlsBase,addEventListener:function(t,e){this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(e)},raiseEvent:function(t,e){if(this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)this.eventListeners[t][n](e)}},Lore.OrbitalControls=function(t,e,n){Lore.ControlsBase.call(this,t),this.up=Lore.Vector3f.up(),this.radius=e,this.camera=t.camera,this.canvas=t.canvas,this.dPhi=0,this.dTheta=0,this.dPan=new Lore.Vector3f,this.spherical=new Lore.SphericalCoords,this.lookAt=n||new Lore.Vector3f,this.scale=.95,this.zoomed=!1,this.camera.position=new Lore.Vector3f(0,0,e),this.camera.updateProjectionMatrix(),this.camera.updateViewMatrix();var o=this;this.addEventListener("mousedrag",function(t){o.update(t.e,t.source)}),this.addEventListener("mousewheel",function(t){o.update({x:0,y:-t.e},"wheel")}),this.update({x:0,y:0},"left")},Lore.OrbitalControls.prototype=Object.assign(Object.create(Lore.ControlsBase.prototype),{constructor:Lore.OrbitalControls,update:function(t,e){if("left"==e)this.dTheta=-2*Math.PI*t.x/(this.canvas.clientWidth*this.camera.zoom),this.dPhi=-2*Math.PI*t.y/(this.canvas.clientHeight*this.camera.zoom);else if("right"==e){var n=t.x*(this.camera.right-this.camera.left)/this.camera.zoom/this.canvas.clientWidth,o=t.y*(this.camera.top-this.camera.bottom)/this.camera.zoom/this.canvas.clientHeight,r=this.camera.getUpVector().components,s=this.camera.getRightVector().components;this.dPan.components[0]=s[0]*-n+r[0]*o,this.dPan.components[1]=s[1]*-n+r[1]*o,this.dPan.components[2]=s[2]*-n+r[2]*o}else"middle"!=e&&"wheel"!=e||(t.y>0?(this.camera.zoom=Math.max(0,this.camera.zoom*this.scale),this.camera.updateProjectionMatrix(),this.zoomed=!0):t.y<0&&(this.camera.zoom=Math.max(0,this.camera.zoom/this.scale),this.camera.updateProjectionMatrix(),this.zoomed=!0));var i=this.camera.position.clone().subtract(this.lookAt);this.spherical.setFromVector(i),this.spherical.components[1]+=this.dPhi,this.spherical.components[2]+=this.dTheta,this.spherical.limit(0,.5*Math.PI,-(1/0),1/0),this.spherical.secure(),this.lookAt.add(this.dPan),i.setFromSphericalCoords(this.spherical),this.camera.position.copyFrom(this.lookAt).add(i),this.camera.setLookAt(this.lookAt),this.camera.updateViewMatrix(),this.dPhi=0,this.dTheta=0,this.dPan.set(0,0,0),this.zoomed&&(this.zoomed=!1)}}),Lore.CameraBase=function(){Lore.Node.call(this),this.type="Lore.CameraBase",this.renderer=null,this.isProjectionMatrixStale=!1,this.isViewMatrixStale=!1,this.projectionMatrix=new Lore.ProjectionMatrix,this.viewMatrix=new Lore.Matrix4f},Lore.CameraBase.prototype=Object.assign(Object.create(Lore.Node.prototype),{constructor:Lore.CameraBase,init:function(t,e){this.gl=t,this.program=e},setLookAt:function(t){this.rotation.lookAt(this.position,t,Lore.Vector3f.up())},updateProjectionMatrix:function(){},updateViewMatrix:function(){this.update();var t=this.modelMatrix.clone();t.invert(),this.viewMatrix=t,this.isViewMatrixStale=!0},getProjectionMatrix:function(){return this.projectionMatrix.entries},getViewMatrix:function(){return this.viewMatrix.entries}}),Lore.OrthographicCamera=function(t,e,n,o,r,s){Lore.CameraBase.call(this),this.type="Lore.OrthographicCamera",this.zoom=1,this.left=t,this.right=e,this.top=n,this.bottom=o,this.near=r||.1,this.far=s||2500,this.updateProjectionMatrix()},Lore.OrthographicCamera.prototype=Object.assign(Object.create(Lore.CameraBase.prototype),{constructor:Lore.OrthographicCamera,updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,o=(this.top+this.bottom)/2,r=n-t,s=n+t,i=o+e,a=o-e;this.projectionMatrix.setOrthographic(r,s,i,a,this.near,this.far),this.isProjectionMatrixStale=!0}}),Lore.Array2=function(t){this.arr=t},Lore.Array2.prototype={constructor:Lore.Array2,multiply:function(t,e,n){t<<=1,this.arr[t]*=e,this.arr[t+1]*=n},multiplyScalar:function(t,e){t<<=1,this.arr[t]*=e,this.arr[t+1]*=e},divide:function(t,e,n){t<<=1,this.arr[t]/=e,this.arr[t+1]/=n},divideScalar:function(t,e){t<<=1,this.arr[t]/=e,this.arr[t+1]/=e},add:function(t,e,n){t<<=1,this.arr[t]+=e,this.arr[t+1]+=n},subtract:function(t,e,n){t<<=1,this.arr[t]-=e,this.arr[t+1]-=n}},Lore.Array3=function(t){this.arr=t},Lore.Array3.prototype={constructor:Lore.Array3,multiply:function(t,e,n,o){t*=3,this.arr[t]*=e,this.arr[t+1]*=n,this.arr[t+2]*=o},multiplyScalar:function(t,e){t*=3,this.arr[t]*=e,this.arr[t+1]*=e,this.arr[t+2]*=e},divide:function(t,e,n,o){t*=3,this.arr[t]/=e,this.arr[t+1]/=n,this.arr[t+2]/=o},divideScalar:function(t,e){t*=3,this.arr[t]/=e,this.arr[t+1]/=e,this.arr[t+2]/=e},add:function(t,e,n,o){t*=3,this.arr[t]+=e,this.arr[t+1]+=n,this.arr[t+2]+=o},subtract:function(t,e,n,o){t*=3,this.arr[t]-=e,this.arr[t+1]-=n,this.arr[t+2]-=o}},Lore.Vector2f=function(t,e){this.components=new Float32Array(2),this.components[0]=t||0,this.components[1]=e||0},Lore.Vector2f.prototype={constructor:Lore.Vector2f,set:function(t,e){return this.components[0]=t,this.components[1]=e,this},getX:function(){return this.components[0]},getY:function(){return this.components[1]},setX:function(t){this.components[0]=t},setY:function(t){this.components[1]=t},lengthSq:function(){return this.components[0]*this.components[0]+this.components[1]*this.components[1]},length:function(){return Math.sqrt(this.lengthSq())},multiply:function(t){return this.components[0]*=t.components[0],this.components[1]*=t.components[1],this},multiplyScalar:function(t){return this.components[0]*=t,this.components[1]*=t,this},divide:function(t){return this.components[0]/=t.components[0],this.components[1]/=t.components[1],this},divideScalar:function(t){return this.components[0]/=t,this.components[1]/=t,this},add:function(t){return this.components[0]+=t.components[0],this.components[1]+=t.components[1],this},subtract:function(t){return this.components[0]-=t.components[0],this.components[1]-=t.components[1],this},clone:function(){return new Lore.Vector2f(this.components[0],this.components[1])},equals:function(t){return this.components[0]===t.components[0]&&this.components[1]===t.components[1]}},Lore.Vector2f.multiply=function(t,e){return new Lore.Vector2f(t.components[0]*e.components[0],t.components[1]*e.components[1])},Lore.Vector2f.multiplyScalar=function(t,e){return new Lore.Vector2f(t.components[0]*e,t.components[1]*e)},Lore.Vector2f.divide=function(t,e){return new Lore.Vector2f(t.components[0]/e.components[0],t.components[1]/e.components[1])},Lore.Vector2f.divideScalar=function(t,e){return new Lore.Vector2f(t.components[0]/e,t.components[1]/e)},Lore.Vector2f.add=function(t,e){return new Lore.Vector2f(t.components[0]+e.components[0],t.components[1]+e.components[1])},Lore.Vector2f.subtract=function(t,e){return new Lore.Vector2f(t.components[0]-e.components[0],t.components[1]-e.components[1])},Lore.Vector3f=function(t,e,n){1===arguments.length?this.components=new Float32Array(t):(this.components=new Float32Array(3),this.components[0]=t||0,this.components[1]=e||0,this.components[2]=n||0)},Lore.Vector3f.prototype={constructor:Lore.Vector3f,set:function(t,e,n){return this.components[0]=t,this.components[1]=e,this.components[2]=n,this},getX:function(){return this.components[0]},getY:function(){return this.components[1]},getZ:function(){return this.components[2]},setX:function(t){return this.components[0]=t,this},setY:function(t){return this.components[1]=t,this},setZ:function(t){return this.components[2]=t,this},setFromSphericalCoords:function(t){var e=t.components[0],n=t.components[1],o=t.components[2],r=Math.sin(n)*e;return this.components[0]=Math.sin(o)*r,this.components[1]=Math.cos(n)*e,this.components[2]=Math.cos(o)*r,this},copyFrom:function(t){return this.components[0]=t.components[0],this.components[1]=t.components[1],this.components[2]=t.components[2],this},setLength:function(t){return this.multiplyScalar(t/this.length())},lengthSq:function(){return this.components[0]*this.components[0]+this.components[1]*this.components[1]+this.components[2]*this.components[2]},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},multiply:function(t){return this.components[0]*=t.components[0],this.components[1]*=t.components[1],this.components[2]*=t.components[2],this},multiplyScalar:function(t){return this.components[0]*=t,this.components[1]*=t,this.components[2]*=t,this},divide:function(t){return this.components[0]/=t.components[0],this.components[1]/=t.components[1],this.components[2]/=t.components[2],this},divideScalar:function(t){return this.components[0]/=t,this.components[1]/=t,this.components[2]/=t,this},add:function(t){return this.components[0]+=t.components[0],this.components[1]+=t.components[1],this.components[2]+=t.components[2],this},subtract:function(t){return this.components[0]-=t.components[0],this.components[1]-=t.components[1],this.components[2]-=t.components[2],this},dot:function(t){return this.components[0]*t.components[0]+this.components[1]*t.components[1]+this.components[2]*t.components[2]},cross:function(t){return new Lore.Vector3f(this.components[1]*t.components[2]-this.components[2]*t.components[1],this.components[2]*t.components[0]-this.components[0]*t.components[2],this.components[0]*t.components[1]-this.components[1]*t.components[0])},project:function(t){return this.applyProjection(Lore.Matrix4f.multiply(t.projectionMatrix,Lore.Matrix4f.invert(t.modelMatrix)))},unproject:function(t){return this.applyProjection(Lore.Matrix4f.multiply(t.modelMatrix,Lore.Matrix4f.invert(t.projectionMatrix)))},applyProjection:function(t){var e=this.components[0],n=this.components[1],o=this.components[2],r=t.entries,s=1/(r[3]*e+r[7]*n+r[11]*o+r[15]);return this.components[0]=(r[0]*e+r[4]*n+r[8]*o+r[12])*s,this.components[1]=(r[1]*e+r[5]*n+r[9]*o+r[13])*s,this.components[2]=(r[2]*e+r[6]*n+r[10]*o+r[14])*s,this},toDirection:function(t){var e=this.components[0],n=this.components[1],o=this.components[2],r=t.entries;this.components[0]=r[0]*e+r[4]*n+r[8]*o,this.components[1]=r[1]*e+r[5]*n+r[9]*o,this.components[2]=r[2]*e+r[6]*n+r[10]*o,this.normalize()},applyQuaternion:function(t){var e=this.components[0],n=this.components[1],o=this.components[2],r=t.components[0],s=t.components[1],i=t.components[2],a=t.components[3],c=a*e+s*o-i*n,h=a*n+i*e-r*o,m=a*o+r*n-s*e,u=-r*e-s*n-i*o;return this.components[0]=c*a+u*-r+h*-i-m*-s,this.components[1]=h*a+u*-s+m*-r-c*-i,this.components[2]=m*a+u*-i+c*-s-h*-r,this},clone:function(){return new Lore.Vector3f(this.components[0],this.components[1],this.components[2])},equals:function(t){return this.components[0]===t.components[0]&&this.components[1]===t.components[1]&&this.components[2]===t.components[2]},toString:function(){return"("+this.components[0]+", "+this.components[1]+", "+this.components[2]+")"}},Lore.Vector3f.normalize=function(t){return Lore.Vector3f.divideScalar(t,t.length())},Lore.Vector3f.multiply=function(t,e){return new Lore.Vector3f(t.components[0]*e.components[0],t.components[1]*e.components[1],t.components[2]*e.components[2])},Lore.Vector3f.multiplyScalar=function(t,e){return new Lore.Vector3f(t.components[0]*e,t.components[1]*e,t.components[2]*e)},Lore.Vector3f.divide=function(t,e){return new Lore.Vector3f(t.components[0]/e.components[0],t.components[1]/e.components[1],t.components[2]/e.components[2])},Lore.Vector3f.divideScalar=function(t,e){return new Lore.Vector3f(t.components[0]/e,t.components[1]/e,t.components[2]/e)},Lore.Vector3f.add=function(t,e){return new Lore.Vector3f(t.components[0]+e.components[0],t.components[1]+e.components[1],t.components[2]+e.components[2])},Lore.Vector3f.subtract=function(t,e){return new Lore.Vector3f(t.components[0]-e.components[0],t.components[1]-e.components[1],t.components[2]-e.components[2])},Lore.Vector3f.cross=function(t,e){return new Lore.Vector3f(t.components[1]*e.components[2]-t.components[2]*e.components[1],t.components[2]*e.components[0]-t.components[0]*e.components[2],t.components[0]*e.components[1]-t.components[1]*e.components[0])},Lore.Vector3f.dot=function(t,e){return t.components[0]*e.components[0]+t.components[1]*e.components[1]+t.components[2]*e.components[2]},Lore.Vector3f.forward=function(){return new Lore.Vector3f(0,0,1)},Lore.Vector3f.up=function(){return new Lore.Vector3f(0,1,0)},Lore.Vector3f.right=function(){return new Lore.Vector3f(1,0,0)},Lore.Matrix3f=function(t){this.entries=t||new Float32Array([1,0,0,0,1,0,0,0,1])},Lore.Matrix3f.prototype={constructor:Lore.Matrix3f,clone:function(){return new Lore.Matrix3f(new Float32Array(this.entries))},equals:function(t){for(var e=0;e<this.entries.length;e++)if(this.entries[e]!==t.entries[e])return!1;return!0}},Lore.Matrix4f=function(t){this.entries=t||new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},Lore.Matrix4f.prototype={constructor:Lore.Matrix4f,set:function(t,e,n,o,r,s,i,a,c,h,m,u,p,l,f,d){this.entries.set([t,e,n,o,r,s,i,a,c,h,m,u,p,l,f,d])},multiplyA:function(t){var e=this.entries[0],n=this.entries[4],o=this.entries[8],r=this.entries[12],s=this.entries[1],i=this.entries[5],a=this.entries[9],c=this.entries[13],h=this.entries[2],m=this.entries[6],u=this.entries[10],p=this.entries[14],l=this.entries[3],f=this.entries[7],d=this.entries[11],g=this.entries[15],L=t.entries[0],v=t.entries[4],x=t.entries[8],y=t.entries[12],b=t.entries[1],w=t.entries[5],A=t.entries[9],M=t.entries[13],S=t.entries[2],E=t.entries[6],C=t.entries[10],F=t.entries[14],V=t.entries[3],P=t.entries[7],_=t.entries[11],T=t.entries[15];return this.entries[0]=e*L+n*b+o*S+r*V,this.entries[1]=s*L+i*b+a*S+c*V,this.entries[2]=l*L+f*b+d*S+g*V,this.entries[3]=e*v+n*w+o*E+r*P,this.entries[4]=h*L+m*b+u*S+p*V,this.entries[5]=s*v+i*w+a*E+c*P,this.entries[6]=h*v+m*w+u*E+p*P,this.entries[7]=l*v+f*w+d*E+g*P,this.entries[8]=e*x+n*A+o*C+r*_,this.entries[9]=s*x+i*A+a*C+c*_,this.entries[10]=h*x+m*A+u*C+p*_,this.entries[11]=l*x+f*A+d*C+g*_,this.entries[12]=e*y+n*M+o*F+r*T,this.entries[13]=s*y+i*M+a*F+c*T,this.entries[14]=h*y+m*M+u*F+p*T,this.entries[15]=l*y+f*M+d*F+g*T,
this},multiplyB:function(t){var e=t.entries[0],n=t.entries[4],o=t.entries[8],r=t.entries[12],s=t.entries[1],i=t.entries[5],a=t.entries[9],c=t.entries[13],h=t.entries[2],m=t.entries[6],u=t.entries[10],p=t.entries[14],l=t.entries[3],f=t.entries[7],d=t.entries[11],g=t.entries[15],L=this.entries[0],v=this.entries[4],x=this.entries[8],y=this.entries[12],b=this.entries[1],w=this.entries[5],A=this.entries[9],M=this.entries[13],S=this.entries[2],E=this.entries[6],C=this.entries[10],F=this.entries[14],V=this.entries[3],P=this.entries[7],_=this.entries[11],T=this.entries[15];return this.entries[0]=e*L+n*b+o*S+r*V,this.entries[1]=s*L+i*b+a*S+c*V,this.entries[2]=l*L+f*b+d*S+g*V,this.entries[3]=e*v+n*w+o*E+r*P,this.entries[4]=h*L+m*b+u*S+p*V,this.entries[5]=s*v+i*w+a*E+c*P,this.entries[6]=h*v+m*w+u*E+p*P,this.entries[7]=l*v+f*w+d*E+g*P,this.entries[8]=e*x+n*A+o*C+r*_,this.entries[9]=s*x+i*A+a*C+c*_,this.entries[10]=h*x+m*A+u*C+p*_,this.entries[11]=l*x+f*A+d*C+g*_,this.entries[12]=e*y+n*M+o*F+r*T,this.entries[13]=s*y+i*M+a*F+c*T,this.entries[14]=h*y+m*M+u*F+p*T,this.entries[15]=l*y+f*M+d*F+g*T,this},scale:function(t){var e=t.components[0],n=t.components[1],o=t.components[2];return this.entries[0]*=e,this.entries[1]*=e,this.entries[2]*=e,this.entries[3]*=e,this.entries[4]*=n,this.entries[5]*=n,this.entries[6]*=n,this.entries[7]*=n,this.entries[8]*=o,this.entries[9]*=o,this.entries[10]*=o,this.entries[11]*=o,this},setPosition:function(t){return this.entries[12]=t.components[0],this.entries[13]=t.components[1],this.entries[14]=t.components[2],this},setRotation:function(t){var e=t.components[0],n=t.components[1],o=t.components[2],r=t.components[3],s=e+e,i=n+n,a=o+o,c=e*s,h=e*i,m=e*a,u=n*i,p=n*a,l=o*a,f=r*s,d=r*i,g=r*a;return this.entries[0]=1-(u+l),this.entries[1]=h+g,this.entries[2]=m-d,this.entries[4]=h-g,this.entries[5]=1-(c+l),this.entries[6]=p+f,this.entries[8]=m+d,this.entries[9]=p-f,this.entries[10]=1-(c+u),this.entries[3]=0,this.entries[7]=0,this.entries[11]=0,this.entries[12]=0,this.entries[13]=0,this.entries[14]=0,this.entries[15]=1,this},determinant:function(){var t=a.entries[0],e=a.entries[4],n=a.entries[8],o=a.entries[12],r=a.entries[1],s=a.entries[5],i=a.entries[9],c=a.entries[13],h=a.entries[2],m=a.entries[6],u=a.entries[10],p=a.entries[14],l=a.entries[3],f=a.entries[7],d=a.entries[11],g=a.entries[15];return l*(o*i*m-n*c*m-o*s*u+e*c*u+n*s*p-e*i*p)+f*(t*i*p-t*c*u+o*r*u-n*r*p+n*c*h-o*i*h)+d*(t*c*m-t*s*p-o*r*m+e*r*p+o*s*h-e*c*h)+g*(-n*s*h-t*i*m+t*s*u+n*r*m-e*r*u+e*i*h)},decompose:function(t,e,n){var o=(new Lore.Vector3f,new Lore.Matrix4f);position.set(this.entries[12],this.entries[13],this.entries[14]);var r=Math.sqrt(this.entries[0]*this.entries[0]+this.entries[1]*this.entries[1]+this.entries[2]*this.entries[2]),s=Math.sqrt(this.entries[4]*this.entries[4]+this.entries[5]*this.entries[5]+this.entries[6]*this.entries[6]),i=Math.sqrt(this.entries[8]*this.entries[8]+this.entries[9]*this.entries[9]+this.entries[10]*this.entries[10]),a=this.determinant();0>a&&(r=-r),n.set(r,s,i);var c=1/r,h=1/s,m=1/i;return o.entries.set(this.entries),o.entries[0]*=c,o.entries[1]*=c,o.entries[2]*=c,o.entries[4]*=h,o.entries[5]*=h,o.entries[6]*=h,o.entries[8]*=m,o.entries[9]*=m,o.entries[10]*=m,e.setFromMatrix(o),this},compose:function(t,e,n){return this.setRotation(e),this.scale(n),this.setPosition(t),this},invert:function(){var t=new Lore.Matrix4f,e=this.entries;t.entries[0]=e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],t.entries[4]=-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],t.entries[8]=e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],t.entries[12]=-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],t.entries[1]=-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],t.entries[5]=e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],t.entries[9]=-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],t.entries[13]=e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],t.entries[2]=e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],t.entries[6]=-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],t.entries[10]=e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],t.entries[14]=-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],t.entries[3]=-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],t.entries[7]=e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],t.entries[11]=-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],t.entries[15]=e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5];var n=e[0]*t.entries[0]+e[1]*t.entries[4]+e[2]*t.entries[8]+e[3]*t.entries[12];if(0==n)throw"Determinant is zero.";n=1/n;for(var o=0;16>o;o++)this.entries[o]=t.entries[o]*n;return this},clone:function(){return new Lore.Matrix4f(new Float32Array(this.entries))},equals:function(t){for(var e=0;e<this.entries.length;e++)if(this.entries[e]!==t.entries[e])return!1;return!0},toString:function(){console.log(this.entries[0]+", "+this.entries[4]+", "+this.entries[8]+", "+this.entries[12]),console.log(this.entries[1]+", "+this.entries[5]+", "+this.entries[9]+", "+this.entries[13]),console.log(this.entries[2]+", "+this.entries[6]+", "+this.entries[10]+", "+this.entries[14]),console.log(this.entries[3]+", "+this.entries[7]+", "+this.entries[11]+", "+this.entries[15])}},Lore.Matrix4f.multiply=function(t,e){var n=t.entries[0],o=t.entries[4],r=t.entries[8],s=t.entries[12],i=t.entries[1],a=t.entries[5],c=t.entries[9],h=t.entries[13],m=t.entries[2],u=t.entries[6],p=t.entries[10],l=t.entries[14],f=t.entries[3],d=t.entries[7],g=t.entries[11],L=t.entries[15],v=e.entries[0],x=e.entries[4],y=e.entries[8],b=e.entries[12],w=e.entries[1],A=e.entries[5],M=e.entries[9],S=e.entries[13],E=e.entries[2],C=e.entries[6],F=e.entries[10],V=e.entries[14],P=e.entries[3],_=e.entries[7],T=e.entries[11],R=e.entries[15];return new Lore.Matrix4f(new Float32Array([n*v+o*w+r*E+s*P,i*v+a*w+c*E+h*P,m*v+u*w+p*E+l*P,f*v+d*w+g*E+L*P,n*x+o*A+r*C+s*_,i*x+a*A+c*C+h*_,m*x+u*A+p*C+l*_,f*x+d*A+g*C+L*_,n*y+o*M+r*F+s*T,i*y+a*M+c*F+h*T,m*y+u*M+p*F+l*T,f*y+d*M+g*F+L*T,n*b+o*S+r*V+s*R,i*b+a*S+c*V+h*R,m*b+u*S+p*V+l*R,f*b+d*S+g*V+L*R]))},Lore.Matrix4f.fromQuaternion=function(t){var e=t.components[0],n=t.components[1],o=t.components[2],r=t.components[3],s=e+e,i=n+n,a=o+o,c=e*s,h=e*i,m=e*a,u=n*i,p=n*a,l=o*a,f=r*s,d=r*i,g=r*a;return new Lore.Matrix4f(new Float32Array([1-(u+l),h+g,m-d,0,h-g,1-(c+l),p+f,0,m+d,p-f,1-(c+u),0,0,0,0,1]))},Lore.Matrix4f.lookAt=function(t,e,n){var o=Lore.Vector3f.subtract(t,e).normalize();0===o.lengthSq()&&(o.components[2]=1);var r=Lore.Vector3f.cross(n,o).normalize();0===r.lengthSq()&&(o.components[2]+=1e-4,r=Lore.Vector3f.cross(n,o).normalize());var s=Lore.Vector3f.cross(o,r);return new Lore.Matrix4f(new Float32Array([r.components[0],r.components[1],r.components[2],0,s.components[0],s.components[1],s.components[2],0,o.components[0],o.components[1],o.components[2],0,0,0,0,1]))},Lore.Matrix4f.compose=function(t,e,n){var o=new Lore.Matrix4f;return o.setRotation(e),o.scale(n),o.setPosition(t),o},Lore.Matrix4f.invert=function(t){var e=new Lore.Matrix4f,n=t.entries;e.entries[0]=n[5]*n[10]*n[15]-n[5]*n[11]*n[14]-n[9]*n[6]*n[15]+n[9]*n[7]*n[14]+n[13]*n[6]*n[11]-n[13]*n[7]*n[10],e.entries[4]=-n[4]*n[10]*n[15]+n[4]*n[11]*n[14]+n[8]*n[6]*n[15]-n[8]*n[7]*n[14]-n[12]*n[6]*n[11]+n[12]*n[7]*n[10],e.entries[8]=n[4]*n[9]*n[15]-n[4]*n[11]*n[13]-n[8]*n[5]*n[15]+n[8]*n[7]*n[13]+n[12]*n[5]*n[11]-n[12]*n[7]*n[9],e.entries[12]=-n[4]*n[9]*n[14]+n[4]*n[10]*n[13]+n[8]*n[5]*n[14]-n[8]*n[6]*n[13]-n[12]*n[5]*n[10]+n[12]*n[6]*n[9],e.entries[1]=-n[1]*n[10]*n[15]+n[1]*n[11]*n[14]+n[9]*n[2]*n[15]-n[9]*n[3]*n[14]-n[13]*n[2]*n[11]+n[13]*n[3]*n[10],e.entries[5]=n[0]*n[10]*n[15]-n[0]*n[11]*n[14]-n[8]*n[2]*n[15]+n[8]*n[3]*n[14]+n[12]*n[2]*n[11]-n[12]*n[3]*n[10],e.entries[9]=-n[0]*n[9]*n[15]+n[0]*n[11]*n[13]+n[8]*n[1]*n[15]-n[8]*n[3]*n[13]-n[12]*n[1]*n[11]+n[12]*n[3]*n[9],e.entries[13]=n[0]*n[9]*n[14]-n[0]*n[10]*n[13]-n[8]*n[1]*n[14]+n[8]*n[2]*n[13]+n[12]*n[1]*n[10]-n[12]*n[2]*n[9],e.entries[2]=n[1]*n[6]*n[15]-n[1]*n[7]*n[14]-n[5]*n[2]*n[15]+n[5]*n[3]*n[14]+n[13]*n[2]*n[7]-n[13]*n[3]*n[6],e.entries[6]=-n[0]*n[6]*n[15]+n[0]*n[7]*n[14]+n[4]*n[2]*n[15]-n[4]*n[3]*n[14]-n[12]*n[2]*n[7]+n[12]*n[3]*n[6],e.entries[10]=n[0]*n[5]*n[15]-n[0]*n[7]*n[13]-n[4]*n[1]*n[15]+n[4]*n[3]*n[13]+n[12]*n[1]*n[7]-n[12]*n[3]*n[5],e.entries[14]=-n[0]*n[5]*n[14]+n[0]*n[6]*n[13]+n[4]*n[1]*n[14]-n[4]*n[2]*n[13]-n[12]*n[1]*n[6]+n[12]*n[2]*n[5],e.entries[3]=-n[1]*n[6]*n[11]+n[1]*n[7]*n[10]+n[5]*n[2]*n[11]-n[5]*n[3]*n[10]-n[9]*n[2]*n[7]+n[9]*n[3]*n[6],e.entries[7]=n[0]*n[6]*n[11]-n[0]*n[7]*n[10]-n[4]*n[2]*n[11]+n[4]*n[3]*n[10]+n[8]*n[2]*n[7]-n[8]*n[3]*n[6],e.entries[11]=-n[0]*n[5]*n[11]+n[0]*n[7]*n[9]+n[4]*n[1]*n[11]-n[4]*n[3]*n[9]-n[8]*n[1]*n[7]+n[8]*n[3]*n[5],e.entries[15]=n[0]*n[5]*n[10]-n[0]*n[6]*n[9]-n[4]*n[1]*n[10]+n[4]*n[2]*n[9]+n[8]*n[1]*n[6]-n[8]*n[2]*n[5];var o=n[0]*e.entries[0]+n[1]*e.entries[4]+n[2]*e.entries[8]+n[3]*e.entries[12];if(0==o)throw"Determinant is zero.";o=1/o;for(var r=0;16>r;r++)e.entries[r]=e.entries[r]*o;return e},Lore.Quaternion=function(t,e,n,o){1===arguments.length?this.components=new Float32Array(t):2===arguments.length?(this.components=new Float32Array(4),this.setFromAxisAngle(t,e)):(this.components=new Float32Array(4),this.components[0]=t||0,this.components[1]=e||0,this.components[2]=n||0,this.components[3]=void 0!==o?o:1)},Lore.Quaternion.prototype={constructor:Lore.Quaternion,getX:function(){return this.components[0]},getY:function(){return this.components[1]},getZ:function(){return this.components[2]},getW:function(){return this.components[3]},set:function(t,e,n,o){this.components[0]=t,this.components[1]=e,this.components[2]=n,this.components[3]=o},setX:function(t){this.components[0]=t},setY:function(t){this.components[1]=t},setZ:function(t){this.components[2]=t},setW:function(t){this.components[3]=t},setFromAxisAngle:function(t,e){var n=Lore.Vector3f.normalize(t),o=e/2,r=Math.sin(o);this.components[0]=n.components[0]*r,this.components[1]=n.components[1]*r,this.components[2]=n.components[2]*r,this.components[3]=Math.cos(o)},setFromUnitVectors:function(t,e){var n=null,o=t.dot(e)+1;1e-6>o?(n=new Lore.Vector3f,o=0,Math.abs(t.components[0])>Math.abs(t.components[2])?n.set(-t.components[1],t.components[0],0):n.set(0,-t.components[2],t.components[1])):n=Lore.Vector3f.cross(t,e),this.set(n.components[0],n.components[1],n.components[2],o),this.normalize()},lookAt:function(t,e,n){return this.setFromMatrix(Lore.Matrix4f.lookAt(t,e,n)),this},lengthSq:function(){return this.components[0]*this.components[0]+this.components[1]*this.components[1]+this.components[2]*this.components[2]+this.components[3]*this.components[3]},length:function(){return Math.sqrt(this.lengthSq())},inverse:function(){return this.conjugate().normalize()},normalize:function(){var t=this.length();if(0===t)this.components[0]=0,this.components[1]=0,this.components[2]=0,this.components[3]=1;else{var e=1/t;this.components[0]*=e,this.components[1]*=e,this.components[2]*=e,this.components[3]*=e}return this},dot:function(t){return this.components[0]*t.components[0]+this.components[1]*t.components[1]+this.components[2]*t.components[2]+this.components[3]*t.components[3]},multiplyA:function(t){var e=this.components[0]*t.components[3]+this.components[3]*t.components[0]+this.components[1]*t.components[2]-this.components[2]*t.components[1],n=this.components[1]*t.components[3]+this.components[3]*t.components[1]+this.components[2]*t.components[0]-this.components[0]*t.components[2],o=this.components[2]*t.components[3]+this.components[3]*t.components[2]+this.components[0]*t.components[1]-this.components[1]*t.components[0],r=this.components[3]*t.components[3]-this.components[0]*t.components[0]-this.components[1]*t.components[1]-this.components[2]*t.components[2];return this.components[0]=e,this.components[1]=n,this.components[2]=o,this.components[3]=r,this},multiplyB:function(t){var e=t.components[0]*this.components[3]+t.components[3]*this.components[0]+t.components[1]*this.components[2]-t.components[2]*this.components[1],n=t.components[1]*this.components[3]+t.components[3]*this.components[1]+t.components[2]*this.components[0]-t.components[0]*this.components[2],o=t.components[2]*this.components[3]+t.components[3]*this.components[2]+t.components[0]*this.components[1]-t.components[1]*this.components[0],r=t.components[3]*this.components[3]-t.components[0]*this.components[0]-t.components[1]*this.components[1]-t.components[2]*this.components[2];return this.components[0]=e,this.components[1]=n,this.components[2]=o,this.components[3]=r,this},multiplyScalar:function(t){return this.components[0]*=t,this.components[1]*=t,this.components[2]*=t,this.components[3]*=t,this},conjugate:function(){return this.components[0]*=-1,this.components[1]*=-1,this.components[2]*=-1,this},add:function(t){return this.components[0]+=t.components[0],this.components[1]+=t.components[1],this.components[2]+=t.components[2],this.components[3]+=t.components[3],this},subtract:function(t){return this.components[0]-=t.components[0],this.components[1]-=t.components[1],this.components[2]-=t.components[2],this.components[3]-=t.components[3],this},rotateX:function(t){var e=t/2;return this.multiplyA(new Lore.Quaternion(Math.sin(e),0,0,Math.cos(e)))},rotateY:function(t){var e=t/2;return this.multiplyA(new Lore.Quaternion(0,Math.sin(e),0,Math.cos(e)))},rotateZ:function(t){var e=t/2;return this.multiplyA(new Lore.Quaternion(0,0,Math.sin(e),Math.cos(e)))},toAxisAngle:function(){console.warn("The method toAxisAngle() has not been implemented.")},toRotationMatrix:function(){var t=this.components[0],e=this.components[1],n=this.components[2],o=this.components[3],r=t*t,s=t*e,i=t*n,a=t*o,c=e*o,h=e*e,m=e*n,u=n*n,p=n*o,l=new Lore.Matrix4f;return l.entries[0]=1-2*(h+u),l.entries[1]=2*(s+p),l.entries[2]=2*(i-c),l.entries[4]=2*(m-p),l.entries[5]=1-2*(r+u),l.entries[6]=2*(m+a),l.entries[8]=2*(i+c),l.entries[9]=2*(m-a),l.entries[10]=1-2*(r+h),l},setFromMatrix:function(t){var e=t.entries[0],n=t.entries[4],o=t.entries[8],r=t.entries[1],s=t.entries[5],i=t.entries[9],a=t.entries[2],c=t.entries[6],h=t.entries[10],m=e+s+h;if(m>0){var u=.5/Math.sqrt(m+1);this.components[0]=(c-i)*u,this.components[1]=(o-a)*u,this.components[2]=(r-n)*u,this.components[3]=.25/u}else if(e>s&&e>h){var u=2*Math.sqrt(1+e-s-h);this.components[0]=.25*u,this.components[1]=(n+r)/u,this.components[2]=(o+a)/u,this.components[3]=(c-i)/u}else if(s>h){var u=2*Math.sqrt(1+s-e-h);this.components[0]=(n+r)/u,this.components[1]=.25*u,this.components[2]=(i+c)/u,this.components[3]=(o-a)/u}else{var u=2*Math.sqrt(1+h-e-s);this.components[0]=(o+a)/u,this.components[1]=(i+c)/u,this.components[2]=.25*u,this.components[3]=(r-n)/u}return this},clone:function(){return new Lore.Quaternion(this.components[0],this.components[1],this.components[2],this.components[3])},equals:function(t){return this.components[0]===t.components[0]&&this.components[1]===t.components[1]&&this.components[2]===t.components[2]&&this.components[3]===t.components[3]},toString:function(){return"x: "+this.getX()+", y: "+this.getY()+", z: "+this.getZ()+", w: "+this.getW()}},Lore.Quaternion.dot=function(t,e){return new Lore.Quaternion(t.components[0]*e.components[0]+t.components[1]*e.components[1]+t.components[2]*e.components[2]+t.components[3]*e.components[3])},Lore.Quaternion.multiply=function(t,e){return new Lore.Quaternion(t.components[0]*e.components[3]+t.components[3]*e.components[0]+t.components[1]*e.components[2]-t.components[2]*e.components[1],t.components[1]*e.components[3]+t.components[3]*e.components[1]+t.components[2]*e.components[0]-t.components[0]*e.components[2],t.components[2]*e.components[3]+t.components[3]*e.components[2]+t.components[0]*e.components[1]-t.components[1]*e.components[0],t.components[3]*e.components[3]+t.components[0]*e.components[0]+t.components[1]*e.components[1]-t.components[2]*e.components[2])},Lore.Quaternion.multiplyScalar=function(t,e){return new Lore.Quaternion(t.components[0]*e,t.components[1]*e,t.components[2]*e,t.components[3]*e)},Lore.Quaternion.inverse=function(t){var e=new Lore.Quaternion(t.components);return e.conjugate().normalize()},Lore.Quaternion.normalize=function(t){var e=t.length();if(0===e)return new Lore.Quaternion(0,0,0,1);var n=1/e;return new Lore.Quaternion(t.components[0]*n,t.components[1]*n,t.components[2]*n,t.components[3]*n)},Lore.Quaternion.conjugate=function(t){return new Lore.Quaternion(-1*t.components[0],-1*t.components[1],-1*t.components[2],t.components[3])},Lore.Quaternion.add=function(t,e){return new Lore.Quaternion(t.components[0]+e.components[0],t.components[1]+e.components[1],t.components[2]+e.components[2],t.components[3]+e.components[3])},Lore.Quaternion.subtract=function(t,e){return new Lore.Quaternion(t.components[0]-e.components[0],t.components[1]-e.components[1],t.components[2]-e.components[2],t.components[3]-e.components[3])},Lore.Quaternion.fromMatrix=function(t){var e=new Lore.Quaternion;return e.setFromMatrix(t),e},Lore.Quaternion.slerp=function(t,e,n){if(0===n)return new Lore.Quaternion(t.components);if(1===n)return new Lore.Quaternion(e.components);var o=new Lore.Quaternion(e.components),r=t.components[0]*o.components[0]+t.components[1]*o.components[1]+t.components[2]*o.components[2]+t.components[3]*o.components[3];if(0>r&&(o.multiplyScalar(-1),r=-r),Math.abs(r)>=1)return new Lore.Quaternion(t.components);var s=Math.acos(r),i=sqrt(1-r*r);if(Math.abs(i)<.001)return new Lore.Quaternion(.5*t.components[0]+.5*o.components[0],.5*t.components[1]+.5*o.components[1],.5*t.components[2]+.5*o.components[2],.5*t.components[3]+.5*o.components[3]);var a=Math.sin((1-n)*s)/i,c=Math.sin(n*s)/i;return new Lore.Quaternion(t.components[0]*a+o.components[0]*c,t.components[1]*a+o.components[1]*c,t.components[2]*a+o.components[2]*c,t.components[3]*a+o.components[3]*c)},Lore.SphericalCoords=function(t,e,n){this.components=new Float32Array(3),this.radius=void 0!==t?t:1,this.phi=e?e:0,this.theta=n?n:0},Lore.SphericalCoords.prototype={constructor:Lore.SphericalCoords,set:function(t,e,n){return this.components[0]=t,this.components[1]=e,this.components[2]=n,this},secure:function(){return this.components[1]=Math.max(1e-6,Math.min(Math.PI-1e-6,this.components[1])),this},setFromVector:function(t){return this.components[0]=t.length(),0===this.components[0]?(this.components[1]=0,this.components[2]=0):(this.components[1]=Math.acos(Math.max(-1,Math.min(1,t.components[1]/this.components[0]))),this.components[2]=Math.atan2(t.components[0],t.components[2])),this},limit:function(t,e,n,o){this.components[1]=Math.max(t,Math.min(e,this.components[1])),this.components[2]=Math.max(n,Math.min(o,this.components[2]))},clone:function(){return new Lore.SphericalCoords(this.radius,this.phi,this.theta)},toString:function(){return"("+this.components[0]+", "+this.components[1]+", "+this.components[2]+")"}},Lore.ProjectionMatrix=function(){Lore.Matrix4f.call(this)},Lore.ProjectionMatrix.prototype=Object.assign(Object.create(Lore.Matrix4f.prototype),{constructor:Lore.ProjectionMatrix,setOrthographic:function(t,e,n,o,r,s){var i=1/(e-t),a=1/(n-o),c=1/(s-r),h=(e+t)*i,m=(n+o)*a,u=(s+r)*c;return this.set(),this.entries[0]=2*i,this.entries[4]=0,this.entries[8]=0,this.entries[12]=-h,this.entries[1]=0,this.entries[5]=2*a,this.entries[9]=0,this.entries[13]=-m,this.entries[2]=0,this.entries[6]=0,this.entries[10]=-2*c,this.entries[14]=-u,this.entries[3]=0,this.entries[7]=0,this.entries[11]=0,this.entries[15]=1,this}}),Lore.Statistics=function(){},Lore.Statistics.prototype={constructor:Lore.Vector2f},Lore.Statistics.spareRandomNormal=null,Lore.Statistics.randomNormal=function(){var t,e,n,o,r;if(null!==Lore.Statistics.spareRandomNormal)t=Lore.Statistics.spareRandomNormal,Lore.Statistics.spareRandomNormal=null;else{do e=2*Math.random()-1,n=2*Math.random()-1,o=e*e+n*n;while(0===o||o>=1);r=Math.sqrt(-2*Math.log(o)/o),t=e*r,Lore.Statistics.spareRandomNormal=n*r}return t/14},Lore.Statistics.randomNormalInRange=function(t,e){var n;do n=Lore.Statistics.randomNormal();while(t>n||n>e);return n},Lore.Statistics.randomNormalScaled=function(t,e){var n=Lore.Statistics.randomNormalInRange(-1,1);return n*e+t},Lore.Statistics.normalize=function(t){for(var e=Number.MIN_VALUE,n=Number.MAX_VALUE,o=0;o<t.length;o++){var r=t[o];r>e&&(e=r),n>r&&(n=r)}for(var s=e-n,o=0;o<t.length;o++)t[o]=(t[o]-n)/s;return[n,e]},Lore.HelperBase=function(t,e,n){Lore.Node.call(this),this.renderer=t,this.shader=Lore.Shaders[n],this.program=this.renderer.createProgram(this.shader),this.geometry=this.renderer.createGeometry(e,this.program)},Lore.HelperBase.prototype=Object.assign(Object.create(Lore.Node.prototype),{constructor:Lore.HelperBase,setAttribute:function(t,e){this.geometry.addAttribute(t,e)},draw:function(){this.geometry.draw(this.renderer)}}),Lore.PointHelper=function(t,e,n,o){Lore.HelperBase.call(this,t,e,n),this.opts=Lore.Utils.extend(!0,Lore.PointHelper.defaults,o),this.indices=null,this.octree=null,this.geometry.setMode(Lore.DrawModes.points)},Lore.PointHelper.prototype=Object.assign(Object.create(Lore.HelperBase.prototype),{constructor:Lore.PointHelper,getMaxLength:function(t,e,n){return Math.max(t.length,Math.max(e.length,n.length))},setPositions:function(t){this.setAttribute("position",t)},setPositionsXYZ:function(t,e,n,o){for(var r=new Float32Array(3*o),s=0;o>s;s++){var i=3*s;r[i]=t[s]||0,r[i+1]=e[s]||0,r[i+2]=n[s]||0}if(this.opts.octree){for(var a=Lore.AABB.fromPoints(r),c=new Uint32Array(o),s=0;o>s;s++)c[s]=s;this.octree=new Lore.Octree,this.octree.build(c,r,a)}this.setAttribute("position",r)},setPositionsXYZColor:function(t,e,n,o){var r=this.getMaxLength(t,e,n);this.setPositionsXYZ(t,e,n,r),this.setColor(o,r)},setPositionsXYZHues:function(t,e,n,o){var r=this.getMaxLength(t,e,n);this.setPositionsXYZ(t,e,n,r),this.setHues(o,r)},setHues:function(t,e){for(var n=new Float32Array(3*e),o=0;e>o;o++){var r=t[o]||0,s=Lore.Color.hslToRgb(r,.5,.5);n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]}this.setColors(n)},setColors:function(t){this.setAttribute("color",t)},setColor:function(t,e){for(var n=new Float32Array(3*e),o=0;3*e>o;o+=3)n[o]=t.components[0],n[o+1]=t.components[1],n[o+2]=t.components[2];this.setColors(n)}}),Lore.PointHelper.defaults={octree:!0},Lore.CoordinatesHelper=function(t,e,n,o){Lore.HelperBase.call(this,t,e,n),this.opts=Lore.Utils.extend(!0,Lore.CoordinatesHelper.defaults,o),this.geometry.setMode(Lore.DrawModes.lines),this.init()},Lore.CoordinatesHelper.prototype=Object.assign(Object.create(Lore.HelperBase.prototype),{constructor:Lore.CoordinatesHelper,init:function(){var t=this.opts.position.components,e=this.opts.axis,n=[t[0],t[1],t[2],t[0]+e.x.length,t[1],t[2],t[0],t[1],t[2],t[0],t[1]+e.y.length,t[2],t[0],t[1],t[2],t[0],t[1],t[2]+e.z.length],o=e.x.color.components,r=e.y.color.components,s=e.z.color.components,i=[o[0],o[1],o[2],o[0],o[1],o[2],r[0],r[1],r[2],r[0],r[1],r[2],s[0],s[1],s[2],s[0],s[1],s[2]];if(this.opts.box.enabled){var a=this.opts.box.x.color.components,c=this.opts.box.y.color.components,h=this.opts.box.z.color.components;n.push(t[0]+e.x.length,t[1]+e.y.length,t[2]+e.z.length,t[0],t[1]+e.y.length,t[2]+e.z.length,t[0]+e.x.length,t[1],t[2]+e.z.length,t[0],t[1],t[2]+e.z.length,t[0]+e.x.length,t[1]+e.y.length,t[2],t[0],t[1]+e.y.length,t[2],t[0]+e.x.length,t[1]+e.y.length,t[2]+e.z.length,t[0]+e.x.length,t[1],t[2]+e.z.length,t[0],t[1]+e.y.length,t[2]+e.z.length,t[0],t[1],t[2]+e.z.length,t[0]+e.x.length,t[1]+e.y.length,t[2],t[0]+e.x.length,t[1],t[2],t[0]+e.x.length,t[1]+e.y.length,t[2]+e.z.length,t[0]+e.x.length,t[1]+e.y.length,t[2],t[0],t[1]+e.y.length,t[2]+e.z.length,t[0],t[1]+e.y.length,t[2],t[0]+e.x.length,t[1],t[2]+e.z.length,t[0]+e.x.length,t[1],t[2]),i.push(a[0],a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2],c[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2],h[0],h[1],h[2],h[0],h[1],h[2],h[0],h[1],h[2],h[0],h[1],h[2],h[0],h[1],h[2],h[0],h[1],h[2])}for(var m=this.opts.ticks.x,u=e.x.length/m.count,p=this.opts.ticks.y,l=e.y.length/p.count,f=this.opts.ticks.z,d=e.z.length/f.count,g=t[0],L=m.color.components,v=0;v<m.count;v++)g+=u,n.push(g+m.offset.components[0],t[1]+m.offset.components[1],t[2]+m.offset.components[2],g+m.offset.components[0],t[1]+m.offset.components[1]+m.length,t[2]+m.offset.components[2]),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);g=t[0];for(var v=0;v<m.count;v++)g+=u,n.push(g+m.offset.components[0],t[1]+m.offset.components[1],t[2]+m.offset.components[2],g+m.offset.components[0],t[1]+m.offset.components[1],t[2]+m.offset.components[2]+m.length),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);g=t[1],L=p.color.components;for(var v=0;v<p.count;v++)g+=l,n.push(t[0]+m.offset.components[0],g+m.offset.components[1],t[2]+m.offset.components[2],t[0]+m.offset.components[0]+m.length,g+m.offset.components[1],t[2]+m.offset.components[2]),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);g=t[1];for(var v=0;v<p.count;v++)g+=l,n.push(t[0]+m.offset.components[0],g+m.offset.components[1],t[2]+m.offset.components[2],t[0]+m.offset.components[0],g+m.offset.components[1],t[2]+m.offset.components[2]+m.length),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);g=t[2],L=f.color.components;for(var v=0;v<f.count;v++)g+=d,n.push(t[0]+m.offset.components[0],t[1]+m.offset.components[1],g+m.offset.components[2],t[0]+m.offset.components[0],t[1]+m.offset.components[1]+m.length,g+m.offset.components[2]),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);g=t[2];for(var v=0;v<f.count;v++)g+=d,n.push(t[0]+m.offset.components[0],t[1]+m.offset.components[1],g+m.offset.components[2],t[0]+m.offset.components[0]+m.length,t[1]+m.offset.components[1],g+m.offset.components[2]),i.push(L[0],L[1],L[2],L[0],L[1],L[2]);this.setAttribute("position",new Float32Array(n)),this.setAttribute("color",new Float32Array(i))}}),Lore.CoordinatesHelper.defaults={position:new Lore.Vector3f,axis:{x:{length:50,color:Lore.Color.fromHex("#222222")},y:{length:50,color:Lore.Color.fromHex("#222222")},z:{length:50,color:Lore.Color.fromHex("#222222")}},ticks:{x:{count:10,length:5,offset:new Lore.Vector3f,color:Lore.Color.fromHex("#222222")},y:{count:10,length:5,offset:new Lore.Vector3f,color:Lore.Color.fromHex("#222222")},z:{count:10,length:5,offset:new Lore.Vector3f,color:Lore.Color.fromHex("#222222")}},box:{enabled:!0,x:{color:Lore.Color.fromHex("#999999")},y:{color:Lore.Color.fromHex("#999999")},z:{color:Lore.Color.fromHex("#999999")}}},Lore.OctreeHelper=function(t,e,n,o,r){Lore.HelperBase.call(this,t,e,n),this.opts=Lore.Utils.extend(!0,Lore.OctreeHelper.defaults,r),this.octree=o,this.raycaster=new Lore.Raycaster;var s=this;t.controls.addEventListener("mousedown",function(t){var e=t.e.mouse.normalizedPosition;s.raycaster.set(s.renderer.camera,e.x,e.y),console.log(s.octree.raySearch(s.raycaster))}),this.init()},Lore.OctreeHelper.prototype=Object.assign(Object.create(Lore.HelperBase.prototype),{constructor:Lore.OctreeHelper,init:function(){"center"===this.opts.visualize?this.drawCenters():"cubes"===this.opts.visualize&&this.drawBoxes()},drawCenters:function(){this.geometry.setMode(Lore.DrawModes.points);var t=this.octree.aabbs,e=Object.keys(t).length,n=new Float32Array(3*e),o=new Float32Array(3*e),r=0;for(key in t){var s=t[key].center.components,i=3*r;n[i]=1,n[i+1]=1,n[i+2]=1,o[i]=s[0],o[i+1]=s[1],o[i+2]=s[2],r++}this.setAttribute("position",new Float32Array(o)),this.setAttribute("color",new Float32Array(n))},drawBoxes:function(){this.geometry.setMode(Lore.DrawModes.lines);var t=this.octree.aabbs,e=Object.keys(t).length,n=new Float32Array(24*e),o=new Float32Array(24*e),r=0;for(key in t){for(var s=Lore.AABB.getCorners(t[key]),i=0;24>i;i++)o[r+i]=s[i],n[r+i]=1;r+=24}this.setAttribute("position",new Float32Array(o)),this.setAttribute("color",new Float32Array(n))}}),Lore.OctreeHelper.defaults={visualize:!1},Lore.FileReaderBase=function(t){this.elementId=t,this.element=document.getElementById(this.elementId),this.eventListeners={};var e=this;this.element.addEventListener("change",function(){var t=new FileReader;t.onload=function(){e.loaded(t.result)},t.readAsBinaryString(this.files[0])})},Lore.FileReaderBase.prototype={constructor:Lore.FileReaderBase,addEventListener:function(t,e){this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(e)},raiseEvent:function(t,e){if(this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)this.eventListeners[t][n](e)},loaded:function(t){}},Lore.CsvFileReader=function(t,e){Lore.FileReaderBase.call(this,t),this.opts=Lore.Utils.extend(!0,Lore.CsvFileReader.defaults,e),this.columns=[]},Lore.CsvFileReader.prototype=Object.assign(Object.create(Lore.FileReaderBase.prototype),{constructor:Lore.CsvFileReader,loaded:function(t){t=t.replace("\n\n","\n"),t=t.replace(/^\s+|\s+$/g,"");for(var e=t.split("\n"),n=e.length,o=!0,r=this.opts.cols,s=this.opts.header?1:0,i=s;n>i;i++){var a=e[i].split(this.opts.separator);if(0==r.length)for(var c=0;c<a.length;c++)r.push[c];if(o){for(var c=0;c<r.length;c++)this.createArray(c,this.opts.types[c],n-s);o=!1}for(var c=0;c<r.length;c++)this.columns[c][i-s]=a[r[c]]}this.raiseEvent("loaded",this.columns)},createArray:function(t,e,n){"Int8Array"==e?this.columns[t]=new Int8Array(n):"Uint8Array"==e?this.columns[t]=new Uint8Array(n):"Uint8ClampedArray"==e?this.columns[t]=new Uint8ClampedArray(n):"Int16Array"==e?this.columns[t]=new Int16Array(n):"Uint16Array"==e?this.columns[t]=new Uint16Array(n):"Int32Array"==e?this.columns[t]=new Int32Array(n):"Uint32Array"==e?this.columns[t]=new Uint32Array(n):"Float32Array"==e?this.columns[t]=new Float32Array(n):"Float64Array"==e?this.columns[t]=new Float64Array(n):this.columns[t]=new Array(n)}}),Lore.CsvFileReader.defaults={separator:",",cols:[],types:[],header:!0},Lore.Utils={},Lore.Utils.extend=function(){var t={},e=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var r=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e&&"[object Object]"===Object.prototype.toString.call(n[o])?t[o]=Lore.Utils.extend(!0,t[o],n[o]):t[o]=n[o])};o>n;n++){var s=arguments[n];r(s)}return t},Lore.Utils.arrayContains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},Lore.Utils.concatTypedArrays=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n},Lore.Utils.msb=function(t){return 2147483648&t?31:Lore.Utils.msb(t<<1|1)-1},Lore.Utils.mergePointDistances=function(t,e){var n={};return n.indices=Lore.Utils.concatTypedArrays(t.indices,e.indices),n.distancesSq=Lore.Utils.concatTypedArrays(t.distancesSq,e.distancesSq),n},Lore.Shaders["default"]=new Lore.Shader("Default",{size:new Lore.Uniform("size",1,"float")},["uniform float size;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);","gl_PointSize = 5.0; //size;","vColor = color;","}"],["varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"]),Lore.Shaders.circle=new Lore.Shader("Circle",{},["attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","gl_PointSize = 10.0;","vColor = color;","}"],["varying vec3 vColor;","void main() {","float r = 1.0, delta = 0.0, alpha = 1.0;","vec2 cxy = 2.0 * gl_PointCoord - 1.0;","r = dot(cxy, cxy);","#ifdef GL_OES_standard_derivatives","delta = fwidth(r);","alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);","#endif","gl_FragColor = vec4(vColor, alpha);","}"]),
Lore.Shaders.defaultEffect=new Lore.Shader("DefaultEffect",{},["attribute vec2 v_coord;","uniform sampler2D fbo_texture;","varying vec2 f_texcoord;","void main() {","gl_Position = vec4(v_coord, 0.0, 1.0);","f_texcoord = (v_coord + 1.0) / 2.0;","}"],["uniform sampler2D fbo_texture;","varying vec2 f_texcoord;","void main(void) {","vec4 color = texture2D(fbo_texture, f_texcoord);","gl_FragColor = color;","}"]),Lore.Shaders.fxaaEffect=new Lore.Shader("FXAAEffect",{},["attribute vec2 v_coord;","uniform sampler2D fbo_texture;","varying vec2 f_texcoord;","void main() {","gl_Position = vec4(v_coord, 0.0, 1.0);","f_texcoord = (v_coord + 1.0) / 2.0;","}"],["#define FXAA_REDUCE_MIN   (1.0/ 128.0)","#define FXAA_REDUCE_MUL   (1.0 / 8.0)","#define FXAA_SPAN_MAX     8.0","vec4 applyFXAA(vec2 fragCoord, sampler2D tex)","{","vec4 color;","vec2 inverseVP = vec2(1.0 / 750.0, 1.0 / 750.0);","vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;","vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;","vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;","vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;","vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;","vec3 luma = vec3(0.299, 0.587, 0.114);","float lumaNW = dot(rgbNW, luma);","float lumaNE = dot(rgbNE, luma);","float lumaSW = dot(rgbSW, luma);","float lumaSE = dot(rgbSE, luma);","float lumaM  = dot(rgbM,  luma);","float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));","float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);","float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);","dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;","vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);","vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);","float lumaB = dot(rgbB, luma);","if ((lumaB < lumaMin) || (lumaB > lumaMax))","color = vec4(rgbA, 1.0);","else","color = vec4(rgbB, 1.0);","return color;","}","uniform sampler2D fbo_texture;","varying vec2 f_texcoord;","void main(void) {","vec4 color = applyFXAA(f_texcoord * 750.0, fbo_texture);","gl_FragColor = color;","}"]),Lore.Octree=function(t,e){this.threshold=t||500,this.maxDepth=e||8,this.points={},this.aabbs={}},Lore.Octree.prototype={constructor:Lore.Octree,build:function(t,e,n,o){o=o||1,n.setLocCode(o),this.points[o]=null,this.aabbs[o]=n;var r=this.getDepth(o);if(t.length<=this.threshold||r>=this.maxDepth){this.points[o]=new Uint32Array(t.length);for(var s=0;s<t.length;s++)this.points[o][s]=t[s];return!0}for(var i=new Uint32Array(8),a=new Float32Array(t.length),s=0;s<t.length;s++){var c=3*t[s];e[c+0]>=n.center.components[0]&&(a[s]|=4),e[c+1]>=n.center.components[1]&&(a[s]|=2),e[c+2]>=n.center.components[2]&&(a[s]|=1),i[a[s]]++}for(var h=new Array(8),m=new Array(8),s=0;8>s;s++)if(0!=i[s]){h[s]=new Uint32Array(i[s]);for(var u=0,c=0;u<t.length;u++)a[u]==s&&(h[s][c++]=t[u]);var p=Lore.Octree.OctreeOffsets[s],l=new Lore.Vector3f(p[0],p[1],p[2]);l.multiplyScalar(n.radius),m[s]=new Lore.AABB(n.center.clone().add(l),.5*n.radius)}for(var s=0;8>s;s++)if(0!=i[s]){var f=this.generateLocCode(o,s);this.build(h[s],e,m[s],f)}},getLocCodes:function(){return Object.keys(this.aabbs)},getDepth:function(t){return Lore.Utils.msb(t)/3},generateLocCode:function(t,e){var n=Lore.Utils.msb(t);return-1==n?8|e:(t=t<<=3,t|e)},traverse:function(t,e){e=e||1;for(var n=0;8>n;n++){var o=e<<3|n;this.aabbs[o]&&(t(this.points[o],this.aabbs[o],o),this.traverse(t,o))}},traverseIf:function(t,e,n){n=n||1;for(var o=0;8>o;o++){var r=n<<3|o;if(this.aabbs[r]){if(!e(this.aabbs[r],r))continue;t(this.points[r],this.aabbs[r],r),this.traverseIf(t,e,r)}}},raySearch:function(t){var e=[],n=t.direction.clone();n.normalize();var o=new Lore.Vector3f(1,1,1);return o.divide(n),this.traverseIf(function(t,n,o){if(t)for(var r=0;r<t.length;r++)e.push({index:t[r],locCode:o})},function(e,n){return e.cylinderTest(t.origin,o,t.far,t.threshold)}),e},getCenters:function(t){t=t||0;var e=new Array;return this.traverse(function(n,o,r){n&&n.length>t&&e.push(o.center)}),e},getClosestBox:function(t,e,n){n=n||1;for(var o=-1,r=Number.MAX_VALUE,s=0;8>s;s++){var i=n<<3|s;if(this.aabbs[i]){if(this.points[i]&&this.points[i].length<e)continue;var a=this.aabbs[i].distanceToPointSq(t.components[0],t.components[1],t.components[2]);r>a&&(r=a,o=i)}}return 0>o?this.aabbs[n]:this.getClosestBox(t,e,o)},getFarthestBox:function(t,e,n){n=n||1;for(var o=-1,r=Number.MIN_VALUE,s=0;8>s;s++){var i=n<<3|s;if(this.aabbs[i]){if(this.points[i]&&this.points[i].length<e)continue;var a=this.aabbs[i].distanceToPointSq(t.components[0],t.components[1],t.components[2]);a>r&&(r=a,o=i)}}return 0>o?this.aabbs[n]:this.getFarthestBox(t,e,o)},getClosestPoint:function(t,e,n,o){n=n||0;var r=Number.MAX_VALUE,s=null,i=null;i=o?this.aabbs[o]:this.getClosestBox(t,n);var a=this.points[i.getLocCode()];if(!a)return null;for(var c=0;c<a.length;c++){var h=a[c];h*=3;var m=e[h],u=e[h+1],p=e[h+2],l=t.components,f=Math.pow(l[0]-m,2)+Math.pow(l[1]-u,2)+Math.pow(l[2]-p,2);r>f&&(r=f,s={x:m,y:u,z:p})}return s?new Lore.Vector3f(s.x,s.y,s.z):null},getFarthestPoint:function(t,e,n,o){n=n||0;var r=Number.MIN_VALUE,s=null,i=null;i=o?this.aabbs[o]:this.getFArthestBox(t,n);var a=this.points[i.getLocCode()];if(!a)return null;for(var c=0;c<a.length;c++){var h=a[c];h*=3;var m=e[h],u=e[h+1],p=e[h+2],l=t.components,f=Math.pow(l[0]-m,2)+Math.pow(l[1]-u,2)+Math.pow(l[2]-p,2);f>r&&(r=f,s={x:m,y:u,z:p})}return s?new Lore.Vector3f(s.x,s.y,s.z):null},getParent:function(t){return t>>>3},getNeighbours:function(t){var e=this,n=new Array;return this.traverseIf(function(e,o,r){e&&e.length>0&&r!=t&&n.push(r)},function(n,o){return n.testAABB(e.aabbs[t])}),n},kNearestNeighbours:function(t,e,n,o,r){t+=1;for(var s=this.positions/3,i=3*e,a={x:o[i],y:o[i+1],z:o[i+2]},c=a.components[0],h=a.components[1],m=a.components[2],u=this.getCellDistancesToPoint(c,h,m,n),p=this.pointDistancesSq(c,h,m,n,o),l=new RadixSort,f=l.sort(p.distancesSq,!0),d=l.sort(u.distancesSq,!0),g=0,L=0,v=new Uint32Array(t),x=0;t>L&&x<f.array.length;x++){if(f.array[x]>d.array[0]){g=x;break}v[x]=p.indices[f.indices[x]],L++}if(L==t)return v;for(var x=0;x<d.array.length;x++){var n=u.locCodes[d.indices[x]],y=this.pointDistancesSq(c,h,m,n,o);p=Lore.Utils.mergePointDistances(p,y);for(var b=l.sort(p.distancesSq,!0),w=g;t>L&&w<b.array.length;w++){if(b.array[w]>d.array[x+1]){g=w;break}v[w]=p.indices[b.indices[w]],L++}if(L==t||L>=s-1)return v}return v},getCellDistancesToPoint:function(t,e,n,o){var r=new Array;this.traverse(function(t,e,n){t&&t.length>0&&n!=o&&r.push(n)});for(var s=new Float32Array(r.length),i=0;i<r.length;i++)s[i]=this.aabbs[r[i]].distanceToPointSq(t,e,n);return{locCodes:r,distancesSq:s}},expandNeighbourhood:function(t,e,n,o,r){for(var s=r.locCodes,i=r.distancesSq,a=s.length,c=a-1;c>=0;c--)for(var h=this.getNeighbours(s[c]),m=0;m<h.length;m++)h[m]==o&&console.log(o),h[m]==o||Lore.Utils.arrayContains(s,h[m])||s.push(h[m]);var u=s.length,p=i.length;if(u!=p){for(var l=new Float32Array(u-p),c=p,f=0;u>c;c++,f++)l[f]=this.aabbs[s[c]].distanceToPointSq(t,e,n);return r.distancesSq=Lore.Utils.concatTypedArrays(i,l),s.length-a}},cellDistancesSq:function(t,e,n,o){for(var r=this.getNeighbours(o),s=new Float32Array(r.length),i=0;i<r.length;i++)s[i]=this.aabbs[r[i]].distanceToPointSq(t,e,n);return{locCodes:r,distancesSq:s}},pointDistancesSq:function(t,e,n,o,r){for(var s=this.points[o],i=new Uint32Array(s.length),a=new Float32Array(s.length),c=0;c<s.length;c++){var h=3*s[c],m=r[h],u=r[h+1],p=r[h+2];i[c]=s[c],a[c]=Math.pow(m-t,2)+Math.pow(u-e,2)+Math.pow(p-n,2)}return{indices:i,distancesSq:a}}},Lore.Octree.clone=function(t){var e=new Lore.Octree;e.threshold=t.threshold,e.maxDepth=t.maxDepth,e.points=t.points;for(var n in t.aabbs)t.aabbs.hasOwnProperty(n)&&(e.aabbs[n]=Lore.AABB.clone(t.aabbs[n]));return e},Lore.Octree.OctreeOffsets=[[-.5,-.5,-.5],[-.5,-.5,.5],[-.5,.5,-.5],[-.5,.5,.5],[.5,-.5,-.5],[.5,-.5,.5],[.5,.5,-.5],[.5,.5,.5]],Lore.AABB=function(t,e){this.center=t||new Lore.Vector3f,this.radius=e||0,this.locCode=0,this.left=0,this.right=0,this.back=0,this.front=0,this.bottom=0,this.top=0,this.neightbours=new Array(6),this.min=new Float32Array(3),this.max=new Float32Array(3),this.updateDimensions()},Lore.AABB.prototype={constructor:Lore.AABB,updateDimensions:function(){var t=this.center.components[0],e=this.center.components[1],n=this.center.components[2];this.min[0]=t-this.radius,this.min[1]=e-this.radius,this.min[2]=n-this.radius,this.max[0]=t+this.radius,this.max[1]=e+this.radius,this.max[2]=n+this.radius,this.left=t-this.radius,this.right=t+this.radius,this.back=n-this.radius,this.front=n+this.radius,this.bottom=e-this.radius,this.top=e+this.radius},setLocCode:function(t){this.locCode=t},getLocCode:function(){return this.locCode},rayTest:function(t,e,n){var o=t.components,r=e.components,s=(this.left-o[0])*r[0],i=(this.right-o[0])*r[0],a=(this.bottom-o[1])*r[1],c=(this.top-o[1])*r[1],h=(this.back-o[2])*r[2],m=(this.front-o[2])*r[2],u=Math.min(Math.max(s,i),Math.max(a,c),Math.max(h,m));if(0>u)return!1;var p=Math.max(Math.min(s,i),Math.min(a,c),Math.min(h,m));return!(p>u||p>n)},cylinderTest:function(t,e,n,o){this.radius+=o,this.updateDimensions();var r=this.rayTest(t,e,n);return this.radius-=o,this.updateDimensions(),r},distanceToPointSq:function(t,e,n){for(var o=0,r=[t,e,n],s=0;3>s;s++)r[s]<this.min[s]&&(o+=Math.pow(this.min[s]-r[s],2)),r[s]>this.max[s]&&(o+=Math.pow(r[s]-this.max[s],2));return o},testAABB:function(t){for(var e=0;3>e;e++)if(this.max[e]<t.min[e]||this.min[e]>t.max[e])return!1;return!0}},Lore.AABB.fromPoints=function(t){for(var e=t[0],n=t[1],o=t[2],r=new Lore.Vector3f(e,n,o),s=new Lore.Vector3f(e,n,o),i=r.components,a=s.components,c=1;c<t.length/3;c++)t[3*c+0]<i[0]&&(i[0]=t[3*c+0]),t[3*c+1]<i[1]&&(i[1]=t[3*c+1]),t[3*c+2]<i[2]&&(i[2]=t[3*c+2]),t[3*c+0]>a[0]&&(a[0]=t[3*c+0]),t[3*c+1]>a[1]&&(a[1]=t[3*c+1]),t[3*c+2]>a[2]&&(a[2]=t[3*c+2]);var h=new Lore.Vector3f.subtract(s,r);h.multiplyScalar(.5);var m=h.components[0],u=h.components[1],p=h.components[2],l=new Lore.Vector3f(m,u,p);l.add(r);var f=Math.max(m,u,p);return new Lore.AABB(l,f)},Lore.AABB.getCorners=function(t){var e=t.center.components,n=e[0],o=e[1],r=e[2],s=t.radius;return[n+s,o+s,r+s,n+s,o+s,r-s,n+s,o-s,r+s,n-s,o+s,r+s,n+s,o-s,r-s,n-s,o-s,r+s,n-s,o+s,r-s,n-s,o-s,r-s]},Lore.AABB.clone=function(t){var e=new Lore.AABB;return e.back=t.back,e.bottom=t.bottom,e.center=new Lore.Vector3f(t.center.components[0],t.center.components[1],t.center.components[2]),e.front=t.front,e.left=t.left,e.locCode=t.locCode,e.max=t.max,e.min=t.min,e.radius=t.radius,e.right=t.right,e.top=t.top,e},Lore.Raycaster=function(){this.origin=new Lore.Vector3f,this.direction=new Lore.Vector3f,this.near=0,this.far=1e3,this.threshold=.5},Lore.Raycaster.prototype={constructor:Lore.Raycaster,set:function(t,e,n){this.near=t.near,this.far=t.far,this.origin.set(e,n,(t.near+t.far)/(t.near-t.far)),this.origin.unproject(t),this.direction.set(0,0,-1),this.direction.toDirection(t.modelMatrix)}},Lore.UI=function(t){this.canvas=document.createElement("canvas"),this.renderCanvasElement=document.getElementById(t),this.init(),this.resize()},Lore.UI.prototype={constructor:Lore.UI,init:function(){this.canvas.style.cssText="position: absolute; pointer-events: none;",this.renderCanvasElement.parentNode.insertBefore(this.canvas,this.renderCanvasElement)},setWidth:function(t){this.canvas.width=t},setHeight:function(t){this.canvas.height=t},setTop:function(t){this.canvas.style.top=t},setLeft:function(t){this.canvas.style.left=t},resize:function(){this.setWidth(this.renderCanvasElement.width),this.setHeight(this.renderCanvasElement.height),this.setTop(this.renderCanvasElement.offsetTop),this.setLeft(this.renderCanvasElement.offsetLeft)}};